;
(function($){
    var ___d = new Date();   
    var ___tem___ = ___d.getTime();   
    $.extend({   
        selectDateSettings:{   
            date:___d.getFullYear()+"-"+(___d.getMonth()+1)+"-"+___d.getDate(),   
            startYear:___d.getFullYear()-10,   
            endYear:___d.getFullYear()+10,   
            dateFormat:"yyyy-MM-dd",
            target:window.self,
            showHour:false
        },   
        selectDateSetup: function( settings ) {
            $.extend( $.selectDateSettings, settings );   
        }   
    })   
    $.fn.extend({
        selectDate:function(startDate,maxDate){
            var _d = new Date();
            var nowDate = eval("new Date("+$.selectDateSettings.date.replace(new RegExp("-","gm"),",")+")");
            nowDate.setMonth(nowDate.getMonth()-1);
            return this.each(function(){   
                var __showDate = function(_obj)   
                {   
                    var _objval=$(_obj).val();
                    if(_objval){
                        _objval=_objval.split(/-| |:/);
                        nowDate=new Date(_objval[0],parseInt(_objval[1])-1,_objval[2]);
                    }
                    var _strYear = new Array();   
                    var _strMonth = new Array();   
                    var _mon = new Array('一月','二月','三月','四月','五月','六月','七月','八月','九月','十月','十一月','十二月');   
                    var _left = parseInt($(_obj).offset().left);   
                    var _top = parseInt($(_obj).offset().top);   
                    var _width = parseInt($(_obj).width());   
                    var _height = parseInt($(_obj).height());   
                       
                    var _maxindex = function(){   
                        var ___index = 0;   
                        $.each($("*",$.selectDateSettings.target.document),function(i,n){   
                             var __tem = $(n,$.selectDateSettings.target.document).css("z-index");   
                             if(__tem>=0)   
                             {   
                                if(__tem >= ___index)   
                                {   
                                    ___index = __tem + 1;      
                                }   
                             }   
                         });   
                        return ___index;
                    }();
                    
                    for(var i = 0 ; i < 12 ; i++)   
                    {   
                        if(i == nowDate.getMonth())   
                        {   
                            _strMonth.push('<option value="'+(i+1)+'" selected="selected">'+_mon[i]+'</option>');   
                        }   
                        else  
                        {   
                            _strMonth.push('<option value="'+(i+1)+'">'+_mon[i]+'</option>');   
                        }   
                    }   
                    for(var j = $.selectDateSettings.startYear ; j <= $.selectDateSettings.endYear ; j++)   
                    {   
                        if(j == nowDate.getYear())   
                        {   
                            _strYear.push('<option value="'+j+'" selected="selected">'+j+'</option>');   
                        }   
                        else  
                        {   
                            _strYear.push('<option value="'+j+'">'+j+'</option>');   
                        }   
                    }   
                    var getDayStr = function(y,m)   
                    {   
                        var year;   
                        var month;   
                        var nextyear;   
                        var nextmonth;
                        if(y=="" || y==undefined)   
                        {   
                            year = parseInt($("select[id=year_"+___tem___+"] option[selected]",$.selectDateSettings.target.document).val());   
                            month = parseInt($("select[id=mon_"+___tem___+"] option[selected]",$.selectDateSettings.target.document).val());   
                        }   
                        else  
                        {   
                            year = parseInt(y);   
                            month = parseInt(m);   
                        }
                        if(year==0){   
                            year = nowDate.getFullYear();   
                            month = nowDate.getMonth()+1;   
                        }
                        var _selectD;   
                        if(month==0){   
                            _selectD = new Date(year-1,11,1);   
                        }else{   
                            _selectD = new Date(year,month-1,1);   
                        }   
                        if(month==12){   
                            nextyear = year+1;   
                            nextmonth = 0;   
                        }   
                        else  
                        {   
                            nextyear = year;   
                            nextmonth = month;   
                        }
                        var _nextD = new Date(nextyear,nextmonth,1);   
                        var __day = parseInt(Math.abs(_nextD - _selectD) / 1000 / 60 / 60 /24);
                        
                        
                        var __str__ = new Array();   
                        __str__.push('<tr>');   
                        for(var ii = 0 ; ii < _selectD.getDay(); ii++)   
                        {   
                            __str__.push('<td width="22px" align="center" valign="middle" bgcolor="#EDF2FC"> </td>');   
                        }
                        var _nowDate=new Date();
                        var _d =(nowDate.getFullYear()==year && nowDate.getMonth()+1 == month);
                        for(var nn = 1 ; nn <= __day; nn++)   
                        {   
                            var _DD_ = new Date(year,month-1,nn); 
                            __str__.push('<td width="22px" height="20px" align="center" valign="middle" style="cursor:pointer; background-color:'+((parseInt(nn)==parseInt(nowDate.getDate()) && _d)?"#BBB":"#EDF2FC")+';" '
                            +'mce_style="cursor:pointer; background-color:'+((parseInt(nn)==parseInt(nowDate.getDate())  && _d)?"#BBB":"#EDF2FC")+';" class="king_date_css" onmouseover="this.style.backgroundColor=\'red\';"'
                            +' onmouseout="this.style.backgroundColor=\'#EDF2FC\';">'+nn+'</td>');
                            if(_DD_.getDay()==6)   
                            {   
                                __str__.push('</tr>');   
                                if(nn<__day)   
                                {   
                                    __str__.push('<tr>');   
                                }   
                            }   
                        }   
                        var __NN__ = _selectD.getDay() + __day;   
                        var __mod__ = __NN__%7   
                        if(__mod__!=0){   
                            for(var mm = 0 ; mm < (7-__mod__) ; mm++)   
                            {   
                                __str__.push('<td width="22" align="center" valign="middle" bgcolor="#EDF2FC"> </td>');   
                            }   
                            __str__.push('</tr>');   
                        }   
                        return '<table cellpadding="0" style="margin:0 auto; width:170px;postion:static" cellspacing="1" style="background-color:#CCCCCC; font-size:12px;" mce_style="background-color:#CCCCCC; font-size:12px;"><tr><td width="22" align="center" valign="middle" bgcolor="#EDF2FC">日</td><td width="22" align="center" valign="middle" bgcolor="#EDF2FC">一</td><td width="22" align="center" valign="middle" bgcolor="#EDF2FC">二</td><td width="22" align="center" valign="middle" bgcolor="#EDF2FC">三</td><td width="22" align="center" valign="middle" bgcolor="#EDF2FC">四</td><td width="22" align="center" valign="middle" bgcolor="#EDF2FC">五</td><td width="22" align="center" valign="middle" bgcolor="#EDF2FC">六</td></tr>'+__str__.join("")+'</table>';
                    }   
                    var __changeDate = function()   
                    {   
                        $("#daystr_"+___tem___,$.selectDateSettings.target.document).empty();   
                        $("#daystr_"+___tem___,$.selectDateSettings.target.document).append(getDayStr());   
                        $(".king_date_css",$.selectDateSettings.target.document).click(function(){   
                            var _y_ = $("select[id=year_"+___tem___+"] option[selected]",$.selectDateSettings.target.document).val();   
                            var _m_ = $("select[id=mon_"+___tem___+"] option[selected]",$.selectDateSettings.target.document).val();   
                            var _d_ = $(this).text();   
                            _m_ = _m_.length < 2 ? "0"+_m_ : _m_;   
                            _d_ = _d_.length < 2 ? "0"+_d_ : _d_;   
                            var returndate = $.selectDateSettings.dateFormat.replace("yyyy",_y_).replace("MM",_m_).replace("dd",_d_);   
                            $(_obj).val(returndate);   
                            $("#dateShowDiv_"+___tem___,$.selectDateSettings.target.document).remove();
                        }); 
                        
                    }   
                    var _str = '<div id="dateShowDiv_'+___tem___+'" style="width:180px;position:absolute;z-index:'+_maxindex+';left:'+(_left)+'px;top:'
                    +(_top+_height+3)+'px;border:1px solid #990;"><table cellpadding="0" cellspacing="0" width="100%" style="background-color:#EDF2FC;" mce_style="background-color:#EDF2FC;"><tr><td>'
                    +'<table cellpadding="0" cellspacing="1" style="background-color:#EDF2FC; font-size:12px; width:100%;position:static;"><tr style="height:25px;"><td>  '
                    +'<a title="上一月" href="javascript:void(null);" mce_href="javascript:void(null);" id="prev_'+___tem___+'" style="font-size:14px;cursor:default;">＜</a><select id="year_'+___tem___+'">'+_strYear.join("")+'</select> 年 </td><td><select id="mon_'+___tem___+'">'
                    +_strMonth.join("")+'</select>月<a href="javascript:void(null);" mce_href="javascript:void(null);" title="下一月" id="next_'+___tem___+'" style="font-size:14px;cursor:default;">＞</a></td></tr></table></td></tr><tr><td><span id="daystr_'+___tem___
                    +'"></span></td></tr><tr><td>';
                    _str+= ' <div style="text-align:center; height:22px; line-height:22px;"><a href="javascript:void(null);" mce_href="javascript:void(null);" id="close_'
                    +___tem___+'" style="font-size:13px; text-align:center; text-decoration:none;color:blue" mce_style="font-size:13px; text-align:center; text-decoration:none;color:blue;">关闭</a>'
                    +' <a href="javascript:void(null);" mce_href="javascript:void(null);" id="currentdate_'
                    +___tem___+'" style="font-size:13px; text-align:center; text-decoration:none;color:blue;" mce_style="font-size:13px; text-align:center; text-decoration:none;color:blue;">当前</a>'
                    +' <a href="javascript:void(null);" mce_href="javascript:void(null);" id="clear_'
                    +___tem___+'" style="font-size:13px; text-align:center; text-decoration:none;color:blue;" mce_style="font-size:13px; text-align:center; text-decoration:none;color:blue;">清空</a>'
                    +'</div></td></tr></table></div>';                     
                    $("body",$.selectDateSettings.target.document).append(_str);   
                    $("#daystr_"+___tem___,$.selectDateSettings.target.document).append(getDayStr());   
                    $("#year_"+___tem___,$.selectDateSettings.target.document).change(function(){   
                        __changeDate();   
                    });   
                    $("#mon_"+___tem___,$.selectDateSettings.target.document).change(function(){   
                        __changeDate();   
                    });   
                    $(".king_date_css",$.selectDateSettings.target.document).click(function(){   
                        var _y_ = $("select[id=year_"+___tem___+"] option[selected]",$.selectDateSettings.target.document).val();   
                        var _m_ = $("select[id=mon_"+___tem___+"] option[selected]",$.selectDateSettings.target.document).val();   
                        var _d_ = $(this).text(); 
                        var returndate =new Date(_y_,_m_-1,_d_);   
                        $(_obj).val(returndate.format($.selectDateSettings.dateFormat));
                        if($._clerequired){
                            $._clerequired($(_obj).attr('id'));
                        }
                        $("#dateShowDiv_"+___tem___,$.selectDateSettings.target.document).remove();
                        
                    });
                    $("#currentdate_"+___tem___,$.selectDateSettings.target.document).click(function(){
                        var sd = new Date();        
                        $(_obj).val(sd.format($.selectDateSettings.dateFormat));
                        if($._clerequired){
                            $._clerequired($(_obj).attr('id'));
                        }
                        $("#dateShowDiv_"+___tem___,$.selectDateSettings.target.document).remove();   
                    }).hover(function(){
                        $(this).css('color','red');
                    },function(){
                         $(this).css('color','blue');
                    });
                    $("#clear_"+___tem___,$.selectDateSettings.target.document).click(function(){                     
                        $(_obj).val('');   
                        $("#dateShowDiv_"+___tem___,$.selectDateSettings.target.document).remove();   
                    }).hover(function(){
                        $(this).css('color','red');
                    },function(){
                         $(this).css('color','blue');
                    });
                    $("#close_"+___tem___,$.selectDateSettings.target.document).click(function(){  
                        $("#dateShowDiv_"+___tem___,$.selectDateSettings.target.document).remove();   
                    }).hover(function(){
                        $(this).css('color','red');
                    },function(){
                         $(this).css('color','blue');
                    });
                    $('#prev_'+___tem___,$.selectDateSettings.target.document).click(function(){
                       var _m_ = $("select[id=mon_"+___tem___+"] option[selected]",$.selectDateSettings.target.document).val();
                       if(parseInt(_m_)>1){
                            sIndex=0;
                            $("select[id=mon_"+___tem___+"] option",$.selectDateSettings.target.document).each(function(){
                                if($(this).val()==parseInt(_m_)-1){
                                    $("select[id=mon_"+___tem___+"]",$.selectDateSettings.target.document)[0].selectedIndex=sIndex;
                                    __changeDate();
                                }
                                sIndex++;
                            });
                       }else{
                           var selectedIndex=$("select[id=year_"+___tem___+"]",$.selectDateSettings.target.document)[0].selectedIndex;
                           $("select[id=year_"+___tem___+"]",$.selectDateSettings.target.document)[0].selectedIndex=selectedIndex-1;
                           sIndex=0;
                            $("select[id=mon_"+___tem___+"] option",$.selectDateSettings.target.document).each(function(){
                                if($(this).val()==12){
                                    $("select[id=mon_"+___tem___+"]",$.selectDateSettings.target.document)[0].selectedIndex=sIndex;
                                    __changeDate();
                                }
                                sIndex++;
                            });
                       }
                    });
                    $('#next_'+___tem___,$.selectDateSettings.target.document).click(function(){
                       var _m_ = $("select[id=mon_"+___tem___+"] option[selected]",$.selectDateSettings.target.document).val();
                       if(parseInt(_m_)<12){
                            sIndex=0;
                            $("select[id=mon_"+___tem___+"] option",$.selectDateSettings.target.document).each(function(){
                                if($(this).val()==parseInt(_m_)+1){
                                    $("select[id=mon_"+___tem___+"]",$.selectDateSettings.target.document)[0].selectedIndex=sIndex;
                                    __changeDate();
                                }
                                sIndex++;
                            });
                       }else{
                           var selectedIndex=$("select[id=year_"+___tem___+"]",$.selectDateSettings.target.document)[0].selectedIndex;
                           $("select[id=year_"+___tem___+"]",$.selectDateSettings.target.document)[0].selectedIndex=selectedIndex+1;
                           sIndex=0;
                            $("select[id=mon_"+___tem___+"] option",$.selectDateSettings.target.document).each(function(){
                                if($(this).val()==1){
                                    $("select[id=mon_"+___tem___+"]",$.selectDateSettings.target.document)[0].selectedIndex=sIndex;
                                    __changeDate();
                                }
                                sIndex++;
                            });
                       }
                    }); 
                }
              
                $(this).click(function(){   
                    $("#dateShowDiv_"+___tem___,$.selectDateSettings.target.document).remove();   
                    __showDate(this);
                });
                $(this).keypress(function(){
                    return false;
                });
                var _sobj = this;   
                   
                $($.selectDateSettings.target.document).click(function(e){   
                    e = e ? e : window.event;   
                    var tag = e.srcElement || e.target;
                    if($(_sobj)[0].id==tag.id)
                    {
                        return;
                    }
                    var _temObj = tag;
                    
                    while(_temObj)   
                    {                        
                        if(_temObj.id=="dateShowDiv_"+___tem___){return;}
                        if(_temObj.id && tag.id && _temObj.id==tag.id){
                            return;
                         }
                        _temObj = _temObj.parentNode;   
                    }
                    $("#dateShowDiv_"+___tem___,$.selectDateSettings.target.document).remove();               
                });   
            });   
        }   
    });   
})(jQuery);


Date.prototype.format=function(fmt) {         
    var o = {         
    "M+" : this.getMonth()+1, //月份         
    "d+" : this.getDate(), //日         
    "h+" : this.getHours()%12 == 0 ? 12 : this.getHours()%12, //小时         
    "H+" : this.getHours(), //小时         
    "m+" : this.getMinutes(), //分         
    "s+" : this.getSeconds(), //秒         
    "q+" : Math.floor((this.getMonth()+3)/3), //季度         
    "S" : this.getMilliseconds() //毫秒         
    };         
    var week = {         
    "0" : "\u65e5",         
    "1" : "\u4e00",         
    "2" : "\u4e8c",         
    "3" : "\u4e09",         
    "4" : "\u56db",         
    "5" : "\u4e94",         
    "6" : "\u516d"        
    };         
    if(/(y+)/.test(fmt)){         
        fmt=fmt.replace(RegExp.$1, (this.getFullYear()+"").substr(4 - RegExp.$1.length));         
    }         
    if(/(E+)/.test(fmt)){         
        fmt=fmt.replace(RegExp.$1, ((RegExp.$1.length>1) ? (RegExp.$1.length>2 ? "\u661f\u671f" : "\u5468") : "")+week[this.getDay()+""]);         
    }         
    for(var k in o){         
        if(new RegExp("("+ k +")").test(fmt)){         
            fmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1) ? (o[k]) : (("00"+ o[k]).substr((""+ o[k]).length)));         
        }         
    }         
    return fmt;         
}